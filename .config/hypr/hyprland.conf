# --- User Set variables ---
$Touchpad_Device=synaptics-tm3625-010
$mainMod = SUPER
$files = thunar
$term = ghostty

# --- Startup Apps ----
exec-once = $HOME/.cargo/bin/waybar-switcher
exec-once = /usr/lib/geoclue-2.0/demos/agent
exec-once = swww-daemon --namespace hypr
exec-once = $HOME/.cargo/bin/wp-daemon
exec-once = /usr/lib/polkit-gnome/polkit-gnome-authentication-agent-1
exec-once = nm-applet --indicator
exec-once = udiskie --tray --no-automount
exec-once = wl-paste --type text --watch cliphist store
exec-once = wl-paste --type image --watch cliphist store
exec-once = hypridle

# --- Monitors ---
monitor=DP-3,preferred,0x0,1
monitor=DP-4,preferred,0x0,1
monitor=eDP-1,2560x1440@60,3440x0,1
monitor=,highrr,auto,1
monitor=,highres,auto,1

# --- Settings Blocks ---
dwindle {
  pseudotile = yes
  preserve_split = yes
  special_scale_factor = 0.8
}

general {
  resize_on_border = true
  layout = dwindle
}

input {
  kb_layout = us
  repeat_rate = 30
  repeat_delay = 300
  natural_scroll = true
  sensitivity = 0
  numlock_by_default = true
  left_handed = false
  follow_mouse = 0
  float_switch_override_focus = false

  touchpad {
    disable_while_typing = true
    natural_scroll = true 
    clickfinger_behavior = false
    middle_button_emulation = true
    tap-to-click = true
    drag_lock = false
  }
  
  touchdevice {
    enabled = false
  }
  
  tablet {
    transform = 0
    left_handed = 0
  }
}
device {
  name = $Touchpad_Device
  enabled = true # $TOUCHPAD_ENABLED was just an alias for true
}

gestures {
  workspace_swipe_distance = 500
  workspace_swipe_invert = true
  workspace_swipe_min_speed_to_force = 30
  workspace_swipe_cancel_ratio = 0.5
  workspace_swipe_create_new = true 
  workspace_swipe_forever = true
}

misc {
  disable_hyprland_logo = true
  disable_splash_rendering = true
  vfr = true
  vrr = 2
  mouse_move_enables_dpms = true
  enable_swallow = off
  swallow_regex = ^(kitty)$
  focus_on_activate = false
  initial_workspace_tracking = 0
  middle_click_paste = false
}

opengl {
  nvidia_anti_flicker = true
}

# This is the CORRECT way to use the 'binds' block
binds {
  workspace_back_and_forth = true
  allow_workspace_cycles = true
  pass_mouse_when_bound = false
}

xwayland {
  enabled = true
  force_zero_scaling = true
}

render {
  direct_scanout = 0
}

cursor {
  sync_gsettings_theme = true
  no_hardware_cursors = 0
  enable_hyprcursor = true
  no_warps = true 
}

group {
  col.border_active = rgba(B6CBD5ff)
  groupbar {
    col.active = rgba(FFFBF3ff)
  }
}

# --- Keybinds (All top-level, duplicates removed) ---

# App Launchers
bind = $mainMod, D, exec, pkill rofi || rofi -show drun -config ~/.config/rofi/config-launcher.rasi
bind = $mainMod, B, exec, xdg-open "https://"
bind = Ctrl+Alt, T, exec, $term
bind = $mainMod, E, exec, $files
bind = $mainMod ALT, C, exec, gnome-calculator

# Our Rust Binaries
bind = SUPER, W, exec, $HOME/.cargo/bin/wp-select
bind = $mainMod SHIFT, P, exec, $HOME/.cargo/bin/kb-launcher
bind = CTRL ALT, P, exec, $HOME/.cargo/bin/power-menu
bind = $mainMod ALT, V, exec, $HOME/.cargo/bin/clip-manager
bind = $mainMod ALT, E, exec, $HOME/.cargo/bin/emoji-picker
bind = $mainMod ALT, R, exec, $HOME/.cargo/bin/radio-menu
bind = $mainMod ALT, F, exec, ghostty --title="waybar-finance" -e $HOME/.cargo/bin/waybar-finance --tui

# System & Window Control
bind = $mainMod, Q, killactive,
bind = CTRL ALT, L, exec, pidof hyprlock || hyprlock & # Replaced LockScreen.sh
bind = $mainMod SHIFT, N, exec, swaync-client -t -sw
bind = $mainMod SHIFT, F, fullscreen
bind = $mainMod CTRL, F, fullscreen, 1
bind = $mainMod, SPACE, togglefloating,
bind = $mainMod ALT, SPACE, exec, hyprctl dispatch workspaceopt allfloat
bind = $mainMod SHIFT, Return, exec, [float; move 15% 5%; size 70% 60%] $term
bind = $mainMod, r, exec, hyprctl reload
bind = CTRL ALT, Delete, exec, hyprctl dispatch exit 0
bind = $mainMod ALT, K, exec, pkill swaync && swaync

# Hardware Keys (Audio, Brightness, etc.)
binde = , xf86MonBrightnessDown, exec, brightnessctl set 5%-
binde = , xf86MonBrightnessUp, exec, brightnessctl set 5%+
bindel = , xf86audioraisevolume, exec, wpctl set-volume -l 1.5 @DEFAULT_AUDIO_SINK@ 5%+
bindel = , xf86audiolowervolume, exec, wpctl set-volume @DEFAULT_AUDIO_SINK@ 5%-
bindl = , xf86AudioMicMute, exec, wpctl set-mute @DEFAULT_AUDIO_SOURCE@ toggle
bindl = , xf86audiomute, exec, wpctl set-mute @DEFAULT_AUDIO_SINK@ toggle
bindl = , xf86Sleep, exec, systemctl suspend 
bindl = , xf86Rfkill, exec, $HOME/.cargo/bin/rfkill-manager

# Layout & Group Control
bind = $mainMod CTRL, D, layoutmsg, removemaster
bind = $mainMod, I, layoutmsg, addmaster
bind = $mainMod, J, layoutmsg, cyclenext
bind = $mainMod, K, layoutmsg, cycleprev
bind = $mainMod CTRL, Return, layoutmsg, swapwithmaster
bind = $mainMod SHIFT, I, togglesplit
bind = $mainMod, P, pseudo,
bind = $mainMod, M, exec, hyprctl dispatch splitratio 0.3
bind = $mainMod, G, togglegroup
bind = $mainMod CTRL, tab, changegroupactive 
bind = ALT, tab, bringactivetotop  

# Focus, Move, Resize
binde = $mainMod SHIFT, left, resizeactive,-50 0
binde = $mainMod SHIFT, right, resizeactive,50 0
binde = $mainMod SHIFT, up, resizeactive,0 -50
binde = $mainMod SHIFT, down, resizeactive,0 50
bind = $mainMod CTRL, left, movewindow, l
bind = $mainMod CTRL, right, movewindow, r
bind = $mainMod CTRL, up, movewindow, u
bind = $mainMod CTRL, down, movewindow, d
bind = $mainMod ALT, left, swapwindow, l
bind = $mainMod ALT, right, swapwindow, r
bind = $mainMod ALT, up, swapwindow, u
bind = $mainMod ALT, down, swapwindow, d
bind = $mainMod, h, movefocus, l
bind = $mainMod, l, movefocus, r
bind = $mainMod, k, movefocus, u
bind = $mainMod, j, movefocus, d

# Workspaces
bind = $mainMod, tab, workspace, m+1
bind = $mainMod SHIFT, tab, workspace, m-1
bind = $mainMod SHIFT, U, movetoworkspace, special
bind = $mainMod, U, togglespecialworkspace,
bind = $mainMod, code:10, workspace, 1
bind = $mainMod, code:11, workspace, 2
bind = $mainMod, code:12, workspace, 3
bind = $mainMod, code:13, workspace, 4
bind = $mainMod, code:14, workspace, 5
bind = $mainMod, code:15, workspace, 6
bind = $mainMod, code:16, workspace, 7
bind = $mainMod, code:17, workspace, 8
bind = $mainMod, code:18, workspace, 9
bind = $mainMod, code:19, workspace, 10
bind = $mainMod SHIFT, code:10, movetoworkspace, 1
bind = $mainMod SHIFT, code:11, movetoworkspace, 2
bind = $mainMod SHIFT, code:12, movetoworkspace, 3
bind = $mainMod SHIFT, code:13, movetoworkspace, 4
bind = $mainMod SHIFT, code:14, movetoworkspace, 5
bind = $mainMod SHIFT, code:15, movetoworkspace, 6
bind = $mainMod SHIFT, code:16, movetoworkspace, 7
bind = $mainMod SHIFT, code:17, movetoworkspace, 8
bind = $mainMod SHIFT, code:18, movetoworkspace, 9
bind = $mainMod SHIFT, code:19, movetoworkspace, 10
bind = $mainMod SHIFT, bracketleft, movetoworkspace, -1
bind = $mainMod SHIFT, bracketright, movetoworkspace, +1
bind = $mainMod CTRL, code:10, movetoworkspacesilent, 1
bind = $mainMod CTRL, code:11, movetoworkspacesilent, 2
bind = $mainMod CTRL, code:12, movetoworkspacesilent, 3
bind = $mainMod CTRL, code:13, movetoworkspacesilent, 4
bind = $mainMod CTRL, code:14, movetoworkspacesilent, 5
bind = $mainMod CTRL, code:15, movetoworkspacesilent, 6
bind = $mainMod CTRL, code:16, movetoworkspacesilent, 7
bind = $mainMod CTRL, code:17, movetoworkspacesilent, 8
bind = $mainMod CTRL, code:18, movetoworkspacesilent, 9
bind = $mainMod CTRL, code:19, movetoworkspacesilent, 10
bind = $mainMod CTRL, bracketleft, movetoworkspacesilent, -1
bind = $mainMod CTRL, bracketright, movetoworkspacesilent, +1

# Mouse Binds
bind = $mainMod, mouse_down, workspace, e+1
bind = $mainMod, mouse_up, workspace, e-1
bind = $mainMod, period, workspace, e+1
bind = $mainMod, comma, workspace, e-1
bindm = $mainMod, mouse:272, movewindow
bindm = $mainMod, mouse:273, resizewindow

# Opacity ON (Transparent)
bind = $mainMod, O, exec, hyprctl --batch "keyword decoration:active_opacity 0.85; keyword decoration:inactive_opacity 0.75"
# Opacity OFF (Opaque)
bind = $mainMod SHIFT, O, exec, hyprctl --batch "keyword decoration:active_opacity 1.0; keyword decoration:inactive_opacity 1.0"

# Screenshots
$shot_dir = $HOME/Pictures/Screenshots
bind = , Print, exec, grim "$shot_dir/$(date +'%Y-%m-%d_%H-%M-%S').png" # Fullscreen
bind = $mainMod, Print, exec, slurp | grim -g - "$shot_dir/$(date +'%Y-%m-%d_%H-%M-%S').png" # Area
bind = Alt, Print, exec, grim -g "$(hyprctl activewindow -j | jq -r '"\(.at[0]),\(.at[1]) \(.size[0])x\(.size[1])"')" "$shot_dir/$(date +'%Y-%m-%d_%H-%M-%S').png" # Active Window

windowrulev2 = tag +browser, class:^([Ff]irefox|org.mozilla.firefox|[Ff]irefox-esr|[Ff]irefox-bin)$
windowrulev2 = tag +browser, class:^([Gg]oogle-chrome(-beta|-dev|-unstable)?)$
windowrulev2 = tag +browser, class:^(chrome-.+-Default)$ # Chrome PWAs
windowrulev2 = tag +browser, class:^([Cc]hromium)$
windowrulev2 = tag +browser, class:^(Brave-browser(-beta|-dev|-unstable)?)$
windowrulev2 = tag +browser, class:^([Tt]horium-browser|[Cc]achy-browser)$
windowrulev2 = tag +browser, class:^(zen-alpha|zen)$
windowrulev2 = tag +notif, class:^(swaync-control-center|swaync-notification-window|swaync-client|class)$

# terminal tags
windowrulev2 = tag +terminal, class:^(Ghostty|ghostty|ghostty-dropterm)$

# email tags
windowrulev2 = tag +email, class:^([Tt]hunderbird|org.gnome.Evolution)$
windowrulev2 = tag +email, class:^(eu.betterbird.Betterbird)$

# project tags
windowrulev2 = tag +projects, class:^(codium|codium-url-handler|VSCodium)$
windowrulev2 = tag +projects, class:^(VSCode|code-url-handler)$
windowrulev2 = tag +projects, class:^(jetbrains-.+)$ # JetBrains IDEs

# screenshare tags
windowrulev2 = tag +screenshare, class:^(com.obsproject.Studio)$

# IM tags
windowrulev2 = tag +im, class:^([Dd]iscord|[Ww]ebCord|[Vv]esktop)$
windowrulev2 = tag +im, class:^([Ff]erdium)$
windowrulev2 = tag +im, class:^([Ww]hatsapp-for-linux)$
windowrulev2 = tag +im, class:^(org.telegram.desktop|io.github.tdesktop_x64.TDesktop)$
windowrulev2 = tag +im, class:^(teams-for-linux)$

# gamestore tags
windowrulev2 = tag +gamestore, class:^([Ss]team)$
windowrulev2 = tag +gamestore, title:^([Ll]utris)$

# file-manager tags
windowrulev2 = tag +file-manager, class:^([Tt]hunar|org.gnome.Nautilus|[Pp]cmanfm-qt)$
windowrulev2 = tag +file-manager, class:^(app.drey.Warp)$

# multimedia tags
windowrulev2 = tag +multimedia, class:^([Aa]udacious)$

# settings tags
windowrulev2 = tag +settings, class:^(wihotspot(-gui)?)$ # wifi hotspot
windowrulev2 = tag +settings, class:^([Bb]aobab|org.gnome.[Bb]aobab)$ # Disk usage analyzer
windowrulev2 = tag +settings, class:^(gnome-disks|wihotspot(-gui)?)$
windowrulev2 = tag +settings, title:(Kvantum Manager)
windowrulev2 = tag +settings, class:^(file-roller|org.gnome.FileRoller)$ # archive manager
windowrulev2 = tag +settings, class:^(nm-applet|nm-connection-editor|blueman-manager)$
windowrulev2 = tag +settings, class:^(pavucontrol|org.pulseaudio.pavucontrol|com.saivert.pwvucontrol)$
windowrulev2 = tag +settings, class:^(qt5ct|qt6ct|[Yy]ad)$
windowrulev2 = tag +settings, class:(xdg-desktop-portal-gtk)
windowrulev2 = tag +settings, class:^([Rr]ofi)$

# viewer tags
windowrulev2 = tag +viewer, class:^(gnome-system-monitor|org.gnome.SystemMonitor|io.missioncenter.MissionCenter)$ # system monitor
windowrulev2 = tag +viewer, class:^(evince)$ # document viewer 
windowrulev2 = tag +viewer, class:^(eog|org.gnome.Loupe)$ # image viewer

# POSITION
windowrulev2 = center, class:([Tt]hunar), title:negative:(.*[Tt]hunar.*)
windowrulev2 = center, title:^(Keybindings)$
windowrulev2 = center, class:^(pavucontrol|org.pulseaudio.pavucontrol|com.saivert.pwvucontrol)$
windowrulev2 = center, class:^([Ww]hatsapp-for-linux|ZapZap|com.rtosta.zapzap)$
windowrulev2 = center, class:^([Ff]erdium)$
windowrulev2 = move 72% 7%,title:^(Picture-in-Picture)$ 
windowrulev2 = idleinhibit fullscreen, fullscreen:1
windowrulev2 = center, title:^(waybar-finance)$

# FLOAT
windowrulev2 = float, tag:wallpaper*
windowrulev2 = float, tag:settings*
windowrulev2 = float, tag:viewer*
windowrulev2 = float, class:([Zz]oom|onedriver|onedriver-launcher)$
windowrulev2 = float, class:(org.gnome.Calculator), title:(Calculator)
windowrulev2 = float, class:^(mpv|com.github.rafostar.Clapper)$
windowrulev2 = float, class:^([Qq]alculate-gtk)$
windowrulev2 = float, class:^([Ff]erdium)$
windowrulev2 = float, title:^(Picture-in-Picture)$
windowrulev2 = float, title:^(Authentication Required)$
windowrulev2 = center, title:^(Authentication Required)$
windowrulev2 = float, class:(codium|codium-url-handler|VSCodium), title:negative:(.*codium.*|.*VSCodium.*)
windowrulev2 = float, class:([Tt]hunar), title:negative:(.*[Tt]hunar.*)
windowrulev2 = float, title:^(Add Folder to Workspace)$
windowrulev2 = size 70% 60%, title:^(Add Folder to Workspace)$
windowrulev2 = center, title:^(Add Folder to Workspace)$
windowrulev2 = float, initialTitle:(Open Files)
windowrulev2 = size 70% 60%, initialTitle:(Open Files)
windowrulev2 = float, title:^(waybar-finance)$

# SIZE
windowrulev2 = size 70% 70%, tag:wallpaper*
windowrulev2 = size 70% 70%, tag:settings*
windowrulev2 = size 60% 70%, class:^([Ww]hatsapp-for-linux|ZapZap|com.rtosta.zapzap)$
windowrulev2 = size 60% 70%, class:^([Ff]erdium)$
windowrulev2 = size 1000 600, title:^(waybar-finance)$

# PINNING
windowrulev2 = pin, title:^(Picture-in-Picture)$

# windowrule v2 - extras
windowrulev2 = keepaspectratio, title:^(Picture-in-Picture)$

# BLUR & FULLSCREEN
windowrulev2 = noblur, tag:games*
windowrulev2 = fullscreen, tag:games*

# LAYER RULES
layerrule = ignore_alpha 0.5, match:namespace rofi
layerrule = ignore_alpha 0.5, match:namespace notifications
windowrulev2 = float, title:^(KeybindCheatSheetApp)$
windowrulev2 = center, title:^(KeybindCheatSheetApp)$
windowrulev2 = size 60% 70%, title:^(KeybindCheatSheetApp)$   

env = GDK_BACKEND,wayland,x11,*
env = QT_QPA_PLATFORM,wayland;xcb
env = CLUTTER_BACKEND,wayland
env = XDG_CURRENT_DESKTOP,Hyprland
env = XDG_SESSION_DESKTOP,Hyprland
env = QT_QUICK_CONTROLS_STYLE,org.hyprland.style
env = GDK_SCALE,1
env = QT_SCALE_FACTOR,1

